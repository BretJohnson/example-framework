<Page x:Class="ExampleFramework.DevTools.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:ExampleFramework.DevTools.Presentation"
      xmlns:models="using:ExampleFramework.DevTools.Presentation.Models"
      xmlns:converters="using:ExampleFramework.DevTools.Presentation.Converters"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:utu="using:Uno.Toolkit.UI"
      NavigationCacheMode="Required"
      Background="#F8F9FA">

  <Page.Resources>
    <!-- Converters -->
    <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    <converters:ExpandCollapseConverter x:Key="ExpandCollapseConverter"/>
    <converters:SelectedTextColorConverter x:Key="SelectedTextColorConverter"/>
    <converters:SelectedBackgroundConverter x:Key="SelectedBackgroundConverter"/>

    <!-- Navigation Item Template -->
    <DataTemplate x:Key="NavigationItemTemplate" x:DataType="models:TreeItem">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Expand/Collapse Button -->
        <Button Grid.Column="0"
                Width="20" Height="20"
                Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Margin="0,0,4,0"
                Command="{Binding DataContext.ToggleExpandCommand, ElementName=PageRoot}"
                CommandParameter="{Binding}"
                Visibility="{Binding IsExpandable, Converter={StaticResource BoolToVisibilityConverter}}">
          <TextBlock Text="{Binding IsExpanded, Converter={StaticResource ExpandCollapseConverter}}"
                     FontSize="12"
                     Foreground="#6B7280"/>
        </Button>

        <!-- Icon -->
        <TextBlock Grid.Column="1"
                   Text="{Binding Icon}"
                   FontSize="14"
                   Margin="0,0,8,0"
                   VerticalAlignment="Center"/>

        <!-- Display Name -->
        <TextBlock Grid.Column="2"
                   Text="{Binding DisplayName}"
                   FontSize="14"
                   Foreground="{Binding IsSelected, Converter={StaticResource SelectedTextColorConverter}}"
                   VerticalAlignment="Center"/>
      </Grid>
    </DataTemplate>
  </Page.Resources>

  <Grid x:Name="PageRoot" utu:SafeArea.Insets="VisibleBounds">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!-- Header -->
    <Border Grid.Row="0"
            Background="#FF6B46C1"
            Padding="16,12">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Title with Logo -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
          <Border Background="#FF10B981"
                  CornerRadius="4"
                  Width="24" Height="24"
                  Margin="0,0,8,0">
            <TextBlock Text="S"
                       FontWeight="Bold"
                       FontSize="14"
                       Foreground="White"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
          </Border>
          <TextBlock Text="{Binding Title}"
                     FontSize="18"
                     FontWeight="SemiBold"
                     Foreground="White"
                     VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Play Button -->
        <Button Grid.Column="1"
                Background="Transparent"
                BorderThickness="0"
                Margin="0,0,8,0"
                Command="{Binding PlayCommand}">
          <TextBlock Text="▶" FontSize="16" Foreground="White"/>
        </Button>

        <!-- Settings Button -->
        <Button Grid.Column="2"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding SettingsCommand}">
          <TextBlock Text="⚙" FontSize="16" Foreground="White"/>
        </Button>
      </Grid>
    </Border>

    <!-- Search Bar -->
    <Border Grid.Row="1"
            Background="White"
            BorderBrush="#E5E7EB"
            BorderThickness="0,0,0,1"
            Padding="16,12">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <TextBox Grid.Column="0"
                 Text="{Binding SearchText, Mode=TwoWay}"
                 PlaceholderText="Find components"
                 Background="Transparent"
                 BorderThickness="0"
                 FontSize="14"/>

        <Button Grid.Column="1"
                Background="Transparent"
                BorderThickness="0"
                Command="{Binding AddComponentCommand}">
          <TextBlock Text="+" FontSize="18" Foreground="#6B7280"/>
        </Button>
      </Grid>
    </Border>

    <!-- Navigation Tree -->
    <ScrollViewer Grid.Row="2"
                  Background="White"
                  Padding="0">
      <ItemsControl ItemsSource="{Binding TreeItems}">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="models:TreeItem">
            <StackPanel>
              <!-- Main Item -->
              <Border Background="{Binding IsSelected, Converter={StaticResource SelectedBackgroundConverter}}"
                      Padding="16,8"
                      Margin="0,1,0,0">
                <Button Background="Transparent"
                        BorderThickness="0"
                        Padding="0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Stretch"
                        Command="{Binding DataContext.SelectItemCommand, ElementName=PageRoot}"
                        CommandParameter="{Binding}">
                  <ContentPresenter Content="{Binding}"
                                    ContentTemplate="{StaticResource NavigationItemTemplate}"/>
                </Button>
              </Border>

              <!-- Children (if expanded) -->
              <ItemsControl ItemsSource="{Binding Children}"
                            Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}"
                            Margin="20,0,0,0">
                <ItemsControl.ItemTemplate>
                  <DataTemplate x:DataType="models:TreeItem">
                    <StackPanel>
                      <!-- Child Item -->
                      <Border Background="{Binding IsSelected, Converter={StaticResource SelectedBackgroundConverter}}"
                              Padding="16,6"
                              Margin="0,1,0,0">
                        <Button Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Stretch"
                                Command="{Binding DataContext.SelectItemCommand, ElementName=PageRoot}"
                                CommandParameter="{Binding}">
                          <ContentPresenter Content="{Binding}"
                                            ContentTemplate="{StaticResource NavigationItemTemplate}"/>
                        </Button>
                      </Border>

                      <!-- Grandchildren (if expanded) -->
                      <ItemsControl ItemsSource="{Binding Children}"
                                    Visibility="{Binding IsExpanded, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Margin="20,0,0,0">
                        <ItemsControl.ItemTemplate>
                          <DataTemplate x:DataType="models:TreeItem">
                            <Border Background="{Binding IsSelected, Converter={StaticResource SelectedBackgroundConverter}}"
                                    Padding="16,6"
                                    Margin="0,1,0,0">
                              <Button Background="Transparent"
                                      BorderThickness="0"
                                      Padding="0"
                                      HorizontalAlignment="Stretch"
                                      HorizontalContentAlignment="Stretch"
                                      Command="{Binding DataContext.SelectItemCommand, ElementName=PageRoot}"
                                      CommandParameter="{Binding}">
                                <ContentPresenter Content="{Binding}"
                                                  ContentTemplate="{StaticResource NavigationItemTemplate}"/>
                              </Button>
                            </Border>
                          </DataTemplate>
                        </ItemsControl.ItemTemplate>
                      </ItemsControl>
                    </StackPanel>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
            </StackPanel>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </ScrollViewer>
  </Grid>
</Page>